---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
library(Seurat)
library(here)
library(tidyverse)
```

```{r}
refquery <- readRDS(here('explore/RDS/Neutrophil.RDS'))
```


```{r}
DimPlot(refquery, group.by = "seurat_clusters", label = T)
```


```{r}
DefaultAssay(refquery) <- "integrated"
Idents(refquery) <- "Diagnosis"

mast_markers <- FindAllMarkers(refquery, only.pos = T, min.pct = 0.25, logfc.threshold = 0.25, test.use = "MAST")
```

```{r}
top20 <- mast_markers %>% 
  group_by(cluster) %>% 
  top_n(n = 20, wt = avg_log2FC)
top20

DoHeatmap(refquery, features = top20$gene) + NoLegend() 
```